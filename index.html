<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大範圍數位孿生碰撞檢測系統設計</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; }
        h1 { border-bottom: 2px solid #2c3e50; color: #2c3e50; }
        h2 { color: #e67e22; margin-top: 30px; }
        .logic-box { background: #f9f9f9; border-left: 5px solid #3498db; padding: 15px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #3498db; color: white; }
        code { background: #eee; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>

    <h1>數位孿生碰撞檢測系統架構說明</h1>

    <section id="intro">
        <h2>0. 核心設計理念</h2>
        <div class="logic-box">
            <strong>為了應付大規模查詢，我們必須有效率地處理大量的碰撞檢測問題。</strong><br>
            單一的檢測演算法無法同時滿足「萬件物件」與「公釐級精度」。因此，本系統採用<strong>分層過濾（Hierarchical Pruning）</strong>策略，根據物件屬性與需求場景，動態配置最佳的資料結構與檢測核心。
        </div>
    </section>

    <section id="data-structures">
        <h2>1. 物件與建築物屬性的最佳化儲存</h2>
        <p>我們將場景物件分為三類，分別採用不同的空間索引策略以極小化運算開銷：</p>
        <table>
            <tr>
                <th>物件類別</th>
                <th>實作方式 (Data Structure)</th>
                <th>理由</th>
            </tr>
            <tr>
                <td><strong>靜態環境 (大樓/牆體)</strong></td>
                <td>Static BVH (AABB Tree)</td>
                <td>建築結構跨度大且不移動，BVH 提供極高的「空間剪枝」效率，能瞬間排除無關房間。</td>
            </tr>
            <tr>
                <td><strong>動態設備 (萬件機器)</strong></td>
                <td>Dynamic BVH / Spatial Hash</td>
                <td>適用於尺寸相近的大量物件，支援快速的 $O(\log N)$ 位置更新。</td>
            </tr>
            <tr>
                <td><strong>編輯中物件 (拖拉物件)</strong></td>
                <td>Fat AABB + Swept Volume</td>
                <td>為編輯中的物體預留緩衝空間，減少每一幀重新計算索引的頻率。</td>
            </tr>
        </table>
    </section>

    <section id="collision-core">
        <h2>2. 高精度 Mesh 碰撞檢測與量化</h2>
        <p>針對精密 Mesh 網格物件，我們不直接進行三角形對撞，而是透過幾何簡化技術：</p>
        <div class="logic-box">
            <ul>
                <li><strong>幾何預處理：</strong> 使用 <strong>V-HACD 演算法</strong> 將複雜 Mesh 分解為一組 <strong>Convex Hulls (凸多面體組合)</strong>。</li>
                <li><strong>干涉判定與深度：</strong> 採用 <strong>GJK (Gilbert-Johnson-Keerthi)</strong> 結合 <strong>EPA (Expanding Polytope Algorithm)</strong>。
                    <ul>
                        <li><strong>GJK：</strong> 快速判定凸體是否碰撞，並給出最短距離。</li>
                        <li><strong>EPA：</strong> 當發生碰撞時，算出精確的 <strong>Location (干涉位置)</strong> 與 <strong>Magnitude (碰撞深度)</strong>。</li>
                    </ul>
                </li>
            </ul>
        </div>
    </section>

    <section id="scenarios">
        <h2>3. 情境需求與代價分析 (Trade-offs)</h2>
        <table>
            <tr>
                <th>需求情境</th>
                <th>首要屬性</th>
                <th>選擇方法</th>
                <th>犧牲代價 (Cost)</th>
            </tr>
            <tr>
                <td><strong>高頻率變動</strong></td>
                <td>低延遲 (Latency)</td>
                <td>Spatial Hashing + SAT</td>
                <td><strong>精確度：</strong> OBB 包圍盒可能會有誤報，需二階確認。</td>
            </tr>
            <tr>
                <td><strong>極高精度需求</strong></td>
                <td>量化精準度 (Accuracy)</td>
                <td>V-HACD + GJK + EPA</td>
                <td><strong>計算資源：</strong> 運算成本高，不適合對場景內所有物件同時施作。</td>
            </tr>
            <tr>
                <td><strong>超大規模固定場景</strong></td>
                <td>吞吐量 (Throughput)</td>
                <td>Dual-Tree Traversal</td>
                <td><strong>記憶體與預處理：</strong> 需預先建構大型靜態 BVH，且佔用較多內存。</td>
            </tr>
        </table>
    </section>

</body>
</html>